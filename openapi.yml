openapi: 3.0.3
info:
  title: Car Marketplace API
  description: API for a car marketplace application with user authentication and car management
  version: 1.0.0
  contact:
    name: API Support
servers:
  - url: http://95.85.126.220/api/v1
    description: Production server
  - url: http://localhost:8080/api/v1
    description: Development server

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    UserRegister:
      type: object
      required:
        - email
        - password
        - username
        - phone
      properties:
        email:
          type: string
          format: email
          example: "user2@gmail.com"
        password:
          type: string
          minLength: 8
          example: "123456783"
        username:
          type: string
          example: "John doe"
        phone:
          type: string
          example: "+12345678"
    
    UserLogin:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "user@gmail.com"
        password:
          type: string
          example: "12345678"
    
    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        refresh_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
    
    ErrorResponse:
      type: object
      properties:
        tk:
          type: string
          description: Turkmen error message
        ru:
          type: string
          description: Russian error message
        en:
          type: string
          description: English error message
    
    BodyType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Sedan"
        image:
          type: string
          example: "/images/body/sedan.png"
    
    Brand:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Toyota"
        logo:
          type: string
          example: "/images/logo/toyota.png"
        car_count:
          type: integer
          example: 0
    
    Model:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Camry"

    Generation:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "XV70"
        image:
          type: string
          example: "/images/gens/1.jpg"
        start_year:
          type: integer
          example: 2018
        end_year:
          type: integer
          example: 2024
        fuel_types:
          type: array
          items:
            $ref: '#/components/schemas/FuelType'
        body_types:
          type: array
          items:
            $ref: '#/components/schemas/BodyType'
        drivetrains:
          type: array
          items:
            $ref: '#/components/schemas/Drivetrain'
        transmissions:
          type: array
          items:
            $ref: '#/components/schemas/Transmission'

    Transmission:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Automatic"

    Engine:
      type: object
      properties:
        id:
          type: integer
          example: 1
        value:
          type: string
          example: "2.5L"

    Drivetrain:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "FWD"

    FuelType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Gasoline"

    Color:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Black"
        hex_code:
          type: string
          example: "#000000"

    GetCarsResponse:
      type: object
      properties:
        id:
          type: integer
          example: 1
        brand:
          type: string
          example: "Toyota"
        region:
          type: string
          example: "Ashgabat"
        city:
          type: string
          example: "Ashgabat"
        model:
          type: string
          example: "Camry"
        transmission:
          type: string
          example: "Automatic"
        engine:
          type: string
          example: "2.5L"
        drivetrain:
          type: string
          example: "FWD"
        body_type:
          type: string
          example: "Sedan"
        fuel_type:
          type: string
          example: "Gasoline"
        year:
          type: integer
          example: 2023
        price:
          type: integer
          example: 35000
        mileage:
          type: integer
          example: 15000
        vin_code:
          type: string
          example: "1HGCM82633A123456"
        exchange:
          type: boolean
          example: false
        credit:
          type: boolean
          example: true
        new:
          type: boolean
          example: false
        color:
          type: string
          example: "Black"
        interior_color:
          type: string
          example: "Beige"
        credit_price:
          type: integer
          example: 38000
        status:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        images:
          type: array
          items:
            type: string
          example: ["/images/cars/1/image1.jpg", "/images/cars/1/image2.jpg"]
        phone_number:
          type: string
          example: "+99361234567"

    CreateCar:
      type: object
      required:
        - brand_id
        - city_id
        - year
        - model_id
        - body_type_id
        - phone_number
        - ownership_type_id
        - price
      properties:
        brand_id:
          type: integer
          example: 1
        city_id:
          type: integer
          example: 1
        year:
          type: integer
          example: 2025
        model_id:
          type: integer
          example: 1
        body_type_id:
          type: integer
          example: 1
        phone_number:
          type: string
          example: "61041499"
        ownership_type_id:
          type: integer
          example: 1
        price:
          type: number
          example: 3000
        region_id:
          type: integer
          example: 1
        transmission_id:
          type: integer
          example: 1
        crash:
          type: boolean
          example: true
        engine_id:
          type: integer
          example: 1
        drivetrain_id:
          type: integer
          example: 1
        fuel_type_id:
          type: integer
          example: 1
        exchange:
          type: boolean
          example: true
        credit:
          type: boolean
          example: true
        Odometer:
          type: integer
          example: 2000
        vin_code:
          type: string
          example: "cjd9jnniu3"
        door_count:
          type: integer
          example: 4
        new:
          type: boolean
          example: true
        interior_color_id:
          type: integer
          example: 1
        color_id:
          type: integer
          example: 2
        right_hand_drive:
          type: boolean
          example: true
        credit_price:
          type: number
          example: 3400
        negotiable:
          type: boolean
          example: true

    SuccessWithId:
      type: object
      properties:
        message:
          type: string
          example: "Car created successfully"
        id:
          type: integer
          example: 1

paths:
  /auth/user-register:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Register a new user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegister'
      responses:
        '200':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid request body or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /auth/user-login:
    post:
      tags:
        - Authentication
      summary: User login
      description: Authenticate user and get access tokens
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLogin'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /users/body-types:
    get:
      tags:
        - Car Data
      summary: Get all body types
      description: Retrieve list of all available car body types
      responses:
        '200':
          description: List of body types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/BodyType'
  
  /users/brands:
    get:
      tags:
        - Car Data
      summary: Get car brands
      description: Retrieve list of car brands with optional text filter
      parameters:
        - name: text
          in: query
          description: Filter brands by text
          required: false
          schema:
            type: string
            example: "o"
      responses:
        '200':
          description: List of car brands
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Brand'
  
  /users/brands/{brand_id}/models:
    get:
      tags:
        - Car Data
      summary: Get models by brand
      description: Retrieve car models for a specific brand
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            type: integer
            example: 1
        - name: text
          in: query
          description: Filter models by text
          required: false
          schema:
            type: string
            example: "r"
      responses:
        '200':
          description: List of car models
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Model'
  
  /users/brands/{brand_id}/models/{model_id}/generations:
    get:
      tags:
        - Car Data
      summary: Get generations by model
      description: Retrieve car generations for a specific model
      parameters:
        - name: brand_id
          in: path
          required: true
          schema:
            type: integer
            example: 1
        - name: model_id
          in: path
          required: true
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: List of car generations
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Generation'
  
  /users/cars:
    get:
      tags:
        - Cars
      summary: Get cars with filters
      description: Retrieve cars with various filtering options
      parameters:
        - name: brands
          in: query
          description: Filter by brand IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: models
          in: query
          description: Filter by model IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: regions
          in: query
          description: Filter by region IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: cities
          in: query
          description: Filter by city IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: generations
          in: query
          description: Filter by generation IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: transmissions
          in: query
          description: Filter by transmission IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: engines
          in: query
          description: Filter by engine IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: drivetrains
          in: query
          description: Filter by drivetrain IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: body_types
          in: query
          description: Filter by body type IDs (comma-separated)
          schema:
            type: string
            example: "1,2"
        - name: fuel_types
          in: query
          description: Filter by fuel type IDs (comma-separated)
          schema:
            type: string
            example: "1,2"
        - name: ownership_types
          in: query
          description: Filter by ownership type IDs (comma-separated)
          schema:
            type: string
            example: "1,2"
        - name: announcement_types
          in: query
          description: Filter by announcement type IDs (comma-separated)
          schema:
            type: string
            example: "1,2,3"
        - name: year_start
          in: query
          description: Filter by minimum year
          schema:
            type: integer
            example: 2020
        - name: year_end
          in: query
          description: Filter by maximum year
          schema:
            type: integer
            example: 2025
        - name: exchange
          in: query
          description: Filter by exchange availability
          schema:
            type: integer
            enum: [0, 1]
            example: 1
        - name: credit
          in: query
          description: Filter by credit availability
          schema:
            type: integer
            enum: [0, 1]
            example: 1
        - name: right_hand_drive
          in: query
          description: Filter by right hand drive
          schema:
            type: integer
            enum: [0, 1]
            example: 1
        - name: price_start
          in: query
          description: Filter by minimum price
          schema:
            type: number
            example: 1000
        - name: price_end
          in: query
          description: Filter by maximum price
          schema:
            type: number
            example: 50000
      responses:
        '200':
          description: List of cars matching filters
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCarsResponse'
    
    post:
      tags:
        - Cars
      summary: Create a new car listing
      description: Create a new car listing
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCar'
      responses:
        '201':
          description: Car created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessWithId'
        '400':
          description: Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /users/cars/{car_id}:
    get:
      tags:
        - Cars
      summary: Get car by ID
      description: Retrieve a specific car by its ID
      parameters:
        - name: car_id
          in: path
          required: true
          schema:
            type: integer
            example: 4
      responses:
        '200':
          description: Car details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetCarsResponse'
        '404':
          description: Car not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /users/cars/{car_id}/images:
    post:
      tags:
        - Cars
      summary: Upload car images
      description: Upload images for a specific car
      security:
        - BearerAuth: []
      parameters:
        - name: car_id
          in: path
          required: true
          schema:
            type: integer
            example: 4
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                images:
                  type: array
                  items:
                    type: string
                    format: binary
      responses:
        '201':
          description: Images uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Car images created successfully"
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Car not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  
  /users/colors:
    get:
      tags:
        - Car Data
      summary: Get car colors
      description: Retrieve list of available car colors
      responses:
        '200':
          description: List of car colors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Color'
  
  /users/drivetrains:
    get:
      tags:
        - Car Data
      summary: Get drivetrain types
      description: Retrieve list of available drivetrain types
      responses:
        '200':
          description: List of drivetrain types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Drivetrain'
  
  /users/engines:
    get:
      tags:
        - Car Data
      summary: Get engine types
      description: Retrieve list of available engine types
      responses:
        '200':
          description: List of engine types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Engine'
  
  /users/fuel-types:
    get:
      tags:
        - Car Data
      summary: Get fuel types
      description: Retrieve list of available fuel types
      responses:
        '200':
          description: List of fuel types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FuelType'
  
  /users/transmissions:
    get:
      tags:
        - Car Data
      summary: Get transmission types
      description: Retrieve list of available transmission types
      responses:
        '200':
          description: List of transmission types
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transmission'
  
  /users/profile/cars:
    get:
      tags:
        - User Profile
      summary: Get user's cars
      description: Retrieve cars belonging to the authenticated user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: List of user's cars
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GetCarsResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

tags:
  - name: Authentication
    description: User authentication endpoints
  - name: Car Data
    description: Car-related reference data
  - name: Cars
    description: Car listing management
  - name: User Profile
    description: User profile management